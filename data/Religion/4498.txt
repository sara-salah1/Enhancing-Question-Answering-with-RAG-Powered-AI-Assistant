في العام التالي، قدم إلى موسم الحج في مكة المكرمة اثنا عشر رجلاً من أهل يثرب، عشرة من الخزرج هم أسعد بن زرارة وعوف بن الحارث ومعاذ بن الحارث ورافع بن مالك وذكوان بن عبد القيس وعبادة بن الصامت ويزيد بن ثعلبة والعباس بن عبادة وعقبة بن عامر وقطبة بن عامر، واثنان من الأوس هما عويم بن ساعدة ومالك بن التيِّهان. والتقى هؤلاء مع النبي صلى الله عليه وسلم عند العقبة حيث بايعوه بيعة العقبة الأولى وعاهدوه على ألا يشرك أحدهم بالله تعالى شيئاً، ولا يسرق ولا يزني.ثم أرسل النبي صلى الله عليه وسلم معهم مصعب بن عمير بن هاشم بن عبد مناف فأخذ يقرئهم القرآن الكريم ويعلمهم الإسلام ويفقههم في الدين، مما ساعد في انتشار الإسلام بيثرب، وكثرة عدد الأنصار فيها، فقدموا إلى النبي صلى الله عليه وسلم في العام التالي.قدم حوالي ثلاثمائة من أهل يثرب في موسم الحج سنة 622م، وكان من بينهم خمسة وسبعون مسلماً منهم امرأتان، وقيل سبعون رجلاً وامرأة واحدة. أحد عشر رجلاً من الأوس منهم: أسد بن حضير، أبو الهيثم بن التيهان، ومن الخزرج اثنان وستون رجلاً منهم: خالد بن زيد، معاذ بن الحارث وأخواه عوف ومعوذ، عمارة بن حزم، أسعد بن زرارة، سهل بن عتيك، وأما المرأتان فهما أم عمارة نسيبة بنت كعب بن عمرو، وأم منيع أسماء بنت عمرو بن عدي.وهكذا فكر النبي صلى الله عليه وسلم في بيعة ثانية لا تقف عند الدعوة إلى الإسلام فقط بل تكون بمثابة حلف يدفع به هؤلاء المسلمون عن أنفسهم الأذى بالأذى والعدوان بالعدوان. فاتفق معهم على اللقاء عند أسفل العقبة، في أوسط أيام التشريق، بعد الفراغ من الحج. وبعد أن مضى ثلث الليل، خرجوا من رحالهم لميعاد النبي صلى الله عليه وسلم، يتسللون تسلل القطا، مستخفين حتى اجتمعوا في الشعب عند العقبة.وقد اعتبرت بيعة العقبة الثانية النبي صلى الله عليه وسلم واحداً من أهل يثرب، دمه كدمهم وحكمه كحكمهم. وهذه الحماية التي تعهد بها الأوس والخزرج لا تبدأ إلا بعد وصول النبي صلى الله عليه وسلم إلى يثرب. لذلك حرص المسلمون على إخفاء أمر هذه البيعة حتى لا تعلم بها قريش، وحتى يأذن الله تعالى بالهجرة إلى يثرب. ورغم أن أحد النقباء قال: بايعنا رسول الله صلى الله عليه وسلم بيعة الحرب. فإن الله تعالى لم يأذن وقتها للنبي صلى الله عليه وسلم بالقتال، خاصة أن العباس بن عبادة قال بعد البيعة: والله الذي بعثك بالحق إن شئت لنميلن على أهل منى غداً بأسيافنا. فقال عليه الصلاة والسلام: لم نؤمر بذلك، ولكن ارجعوا إلى رحالكم.الهجرة إلى يثربأمر النبي صلى الله عليه وسلم المسلمين أن يلحقوا بإخوانهم الأنصار بيثرب، على أن يهاجروا إليها فرادى أو في نفر قليل حتى لا يثيروا غضب قريش التي زادت من اضطهادها وأذاها. وكان أول من هاجر إلى يثرب أبو سلمة عبد الله بن عبد الأسد المخزومي، ثم قدمها عامر بن ربيعة ومعه زوجته ليلى بنت أبي خثمة العدوية، ثم عبد الله بن جحش وأخوه أبو احمد. وبذلك تتابعت هجرة المسلمين إلى يثرب فخرج إليها عمر بن الخطاب رضي الله عنه ولحق به أخوه زيد بن الخطاب، وعمرو وعبد الله ابنا سراقة بن المعتمر، وخنيس بن حذافة السهمي زوج ابنته حفصة.وهكذا بقي النبي صلى الله عليه وسلم مقيماً في مكة المكرمة ينتظر الإذن من الله تعالى في الهجرة، بعد أن هاجر معظم المسلمين، ولم يبق معه إلا علي بن أبي طالب كرم الله وجهه وأبو بكر الصديق رضي الله عنه ومن حبس كرهاً في مكة المكرمة أو فتن عن دينه.كان أبو بكر الصديق رضي الله عنه كثيراً ما يستأذن النبي صلى الله عليه وسلم في الهجرة فيقول له: لا تعجل لعل الله يجعل لك صاحباً. ويقصد أنه ينتظر الأمر بالهجرة معه، وكان عليه الصلاة والسلام يعنيه هو فابتاع راحلتين بثلاثمائة درهم حبسهما في داره يعلفهما، وحمل معه ماله كله خمسة آلاف أو ستة آلاف درهم، إعداداً للهجرة.انطلق النبي صلى الله عليه وسلم مع أبي بكر رضي الله عنه إلى غار ثور وهو في جبل جنوب مكة المكرمة. ولم يعلم بمخبئهما غير عبد الله بن أبي بكر وأختيه عائشة وأسماء ومولاهم عامر بن فهيرة.أما الشبان الذين أعدتهم قريش، فقد دخلوا الدار في الصباح لقتل النبي صلى الله عليه وسلم فوجدوا علياً كرم الله وجهه في الفراش عوضاً عنه. وأخذوا يقتفون أثره حتى أقبلوا نحو غار ثور. وتملك الخوف أبا بكر رضي الله عنه لما شعر بدنوهم من الغار وكان النبي صلى الله عليه وسلم يهمس في أذنه: لا تحزن إن الله معنا.وكان الله سبحانه وتعالى ثالثهما، فما إن أقبل شبان قريش حتى أسرعت العنكبوت إلى نسيج بيتها تستر به من في الغار عن الأعين ثم جاءت حمامتان فباضتا عند بابه وتحت شجرة لم تكن نامية، مما زادهم إقناعاً بأن الغار ليس به أحد وعادوا من حيث أتوا. فقال الله تعالى: إِلَّا تَنْصُرُوهُ فَقَدْ نَصَرَهُ اللَّهُ إِذْ أَخْرَجَهُ الَّذِينَ كَفَرُوا ثَانِيَ اثْنَيْنِ إِذْ هُمَا فِي الْغَارِ إِذْ يَقُولُ لِصَاحِبِهِ لَا تَحْزَنْ إِنَّ اللَّهَ مَعَنَا فَأَنْزَلَ اللَّهُ سَكِينَتَهُ عَلَيْهِ وَأَيَّدَهُ بِجُنُودٍ لَمْ تَرَوْهَا وَجَعَلَ كَلِمَةَ الَّذِينَ كَفَرُوا السُّفْلَى وَكَلِمَةُ اللَّهِ هِيَ الْعُلْيَا وَاللَّهُ عَزِيزٌ حَكِيمٌ (التوبة: 40).